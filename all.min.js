let STRINGS_COLOR="#ffffff",palettes_=[{name:"Shanga",probability:.2,backgrounds:["#1a1a1a"],palette:["#38c5f0","#31c4bf","#4d2617","#fc4d0d","#cc141b","#4d2617","#fcbe03","#f1e0c5","#000000","#036d06","#38c5f0","#fcbe03"],stringColor:[STRINGS_COLOR]},{name:"Leso",probability:.35,backgrounds:["#1a1a1a"],palette:["#000000","#f1e0c5","#cc141b","#fc4d0d","#3939e5","#38c5f0","#230b99","#fcbe03"],stringColor:[STRINGS_COLOR]},{name:"Ardhi",probability:.05,backgrounds:["#1a1a1a"],palette:["#d99f2b","#4d2617","#000000","#d99f2b","#4d2617","#f1e0c5","#fc4d0d","#cc141b","#fcbe03"],stringColor:[STRINGS_COLOR]},{name:"Regal",probability:.07,backgrounds:["#2e2220"],palette:["#d99f2b","#230b99","#d99f2b","#000000","#f1e0c5","#d99f2b","#cc141b"],stringColor:[STRINGS_COLOR]},{name:"Remba",probability:.09,backgrounds:["#2e2220"],palette:["#000000","#f1e0c5","#f5769d","#fcbe03","#fc4d0d","#3939e5","#f5769d","#cc141b","#8556e0"],stringColor:[STRINGS_COLOR]},{name:"Ejersa",probability:.15,backgrounds:["#1a1a1a"],palette:["#cc141b","#000000","#fcbe03","#f1e0c5","#036d06"],stringColor:[STRINGS_COLOR]},{name:"Malaika",probability:.03,backgrounds:["#e0ddd7"],palette:["#d99f2b","#f1e0c5"],stringColor:[STRINGS_COLOR]},{name:"Ndoto",probability:.06,backgrounds:["#2e2220"],palette:["#31c4bf","#38c5f0","#3939e5","#fc4d0d","#230b99"],stringColor:[STRINGS_COLOR]}];function base58ToNumber(t){return parseInt(t.replace(/[^\d]/g,""),10)}function setSeed(t){randomSeed(t)}Array.prototype.shuffle=function(t){for(var e,i,s=this.length,r=new Math.seedrandom(t);0!==s;)i=Math.floor(r()*s),e=this[s-=1],this[s]=this[i],this[i]=e;return this};var seed,params=new URLSearchParams(window.location.search);function generateRandomSeed(){for(var t="0123456789abcdefghijklmnopqrstuvwxyz",e="",i=0;i<44;i++){var s=Math.floor(36*Math.random());e+=t.charAt(s)}return e}var seedNumber=base58ToNumber(seed=params.has("seed")?params.get("seed"):generateRandomSeed()),seededRandom=new Math.seedrandom(seedNumber);class LibRandomClass{constructor(){this.randomFn=Math.random,this.randomFn=seededRandom,this.floorFn=Math.floor}random(){return this.randomFn()}random(t){return this.randomFn()*t}range(t,e){return t+this.randomFn()*(e-t)}list(t){return t[this.floorFn(this.randomFn()*t.length)]}weightedRandom(t){let e,i=0,s=this.randomFn();for(e in t)if(i+=t[e],s<=i)return e}}let scale_=2,libRandom=new LibRandomClass;var recOffsetVal=Math.floor(libRandom.random(0,100));let list_rectangles=[],all_beads=[];function weightedRandom(t){let e=0,i=libRandom.randomFn();for(let i in t)e+=t[i];let s=0;for(let r in t)if(s+=t[r]/e,i<=s)return r;return String(index)}function distance(t,e){let i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}function phyllocheck(t){if(circles.length>0){for(let e=0;e<circles.length;++e){let i=circles[e],s=i.x-t.x,r=i.y-t.y;if(Math.sqrt(s*s+r*r)<i.r+t.r+2)return!1}if(t.x<frameWidth||t.x>width-frameWidth||t.y<frameWidth||t.y>height-frameWidth)return!0}}function collidesWithAnyCircle(t,e){const{col:i,row:s}=e.getIndex(t.x,t.y),r=getNearbyCells(i,s,e.grid.length,e.grid[0].length);for(const i of r)for(const s of e.grid[i.col][i.row]){if((t.r+s.r)/2+0>=distance(t,s))return!0}return!1}function getNearbyCells(t,e,i,s){const r=[];for(let a=Math.max(0,t-1);a<=Math.min(i-1,t+1);a++)for(let t=Math.max(0,e-1);t<=Math.min(s-1,e+1);t++)r.push({col:a,row:t});return r}function streamsContaining(t){var e=0;for(stream of streams)stream.particles.length==t&&e++;console.log("streams containing only "+t+" particle: "+e)}function isValid(t){for(let e=0;e<circles.length;++e){let i=circles[e],s=i.x-t.x,r=i.y-t.y;if(Math.sqrt(s*s+r*r)<i.r+t.r)return!1}return!0}function generateWeights(t){let e={},i=0,s=Array.from({length:t},(()=>libRandom.randomFn()));s.sort(((t,e)=>t-e));for(let r=0;r<t;r++){let a=r==t-1?1-i:s[r+1]-s[r];e[r]=a,i+=a}return e}function calculateBrightness(t){return t=t.replace("#",""),(.2126*parseInt(t.substring(0,2),16)+.7152*parseInt(t.substring(2,4),16)+.0722*parseInt(t.substring(4,6),16))/255}function shuffleBrighterColorsByPercentage(t,e){let i=[...t],s=Math.ceil(t.length*e);if(s<=1)return i;for(let e=t.length-s;e<t.length;e++){let s=Math.floor(libRandom.randomFn()*(t.length-e))+e,r=i[e];i[e]=i[s],i[s]=r}return i}function getMax(t){let e=t.length,i=-1/0;for(;e--;)i=t[e]>i?t[e]:i;return i}function getMin(t){let e=t[0];for(let i=1;i<t.length;++i)t[i]<e&&(e=t[i]);return e}function getClosestColor(t){let e=null,i=1/0,s=red(t),r=green(t),a=blue(t);for(let t=0;t<COLOR_PALETTE.length;t++){let o=color(COLOR_PALETTE[t]),l=dist(s,r,a,o.levels[0],o.levels[1],o.levels[2]);l<i&&(e=o,i=l)}return e}class RandomClass{constructor(){this.randomFn=Math.random,this.randomFn=seededRandom,this.floorFn=Math.floor}random(){return this.randomFn()}random(t){return this.randomFn()*t}range(t,e){return t+this.randomFn()*(e-t)}list(t){return t[this.floorFn(this.randomFn()*t.length)]}weightedRandom(t){let e,i=0,s=this.randomFn();for(e in t)if(i+=t[e],s<=i)return e}}let classRandom=new RandomClass;class Probability{constructor(){this.palettes=palettes_,this.structureProbabilities={0:.95,1:.05},this.beadSizeProbabilities={0:.65,1:.35},this.spiralTypeProbabilities={0:.9,1:.1},this.flowfieldTypeProbabilities={0:.45,1:.2,2:.35},this.stringsProbabilities={0:.6,1:.4},this.rotationCentersProbabilities={1:.2,2:.3,3:.1,4:.4}}calculatePaletteProbability(){const t={};this.palettes.forEach(((e,i)=>{t[i]=e.probability}));const e=parseInt(weightedRandom(t),10);return this.palettes[e]}calculateBeadSizeProbability(){const t=weightedRandom(this.beadSizeProbabilities);return parseInt(t,10)}calculateStructureProbability(){const t=weightedRandom(this.structureProbabilities);return parseInt(t,10)}calculateSpiralTypeProbability(){const t=weightedRandom(this.spiralTypeProbabilities);return parseInt(t,10)}calculateFlowfieldTypeProbability(){const t=weightedRandom(this.flowfieldTypeProbabilities);return parseInt(t,10)}calculateStringsProbability(){const t=weightedRandom(this.stringsProbabilities);return parseInt(t,10)}calculateRotationCentersProbability(){const t=weightedRandom(this.rotationCentersProbabilities);return parseInt(t,10)}}class ColoringTechnique{constructor(){this.styles=[{name:"stripes",variations:["horizontal","vertical"]},{name:"weighted",variations:["","",""]},{name:"gradient",variations:["horizontal","vertical","radial"]},{name:"vector",variations:["","",""]}],this.technique={},this.variation=null,this.random=new RandomClass,this.pickedTechnique=!1,this.pickedVariation=!1,this.pick()}pick(){this.technique=this.random.list(this.styles),"stripes"==COL_TECHNIQUE&&(this.technique=this.styles[0]),"weighted"==COL_TECHNIQUE&&(this.technique=this.styles[1]),"gradient"==COL_TECHNIQUE&&(this.technique=this.styles[2]),"vector"==COL_TECHNIQUE&&(this.technique=this.styles[3]),this.pickedTechnique=!0,this.pickedTechnique&&(this.technique.variations.length>0?(this.variation=this.random.list(this.technique.variations),this.pickedVariation=!0):this.variation="")}assignTechnique(t){!this.pickedTechnique&&this.pickedTechnique||(this.technique=t,this.pickedTechnique=!0),this.pickedTechnique&&this.technique.variations.length>0&&(!this.pickedVariation&&this.pickedVariation||(this.variation=this.random.list(this.technique.variations),this.pickedVariation=!0))}apply(t,e){this.random.floorFn;if("vector"==this.technique.name){var i=t-VECTOR_FIELD.left_x,s=e-VECTOR_FIELD.top_y,r=int(i/VECTOR_FIELD.resolution),a=int(s/VECTOR_FIELD.resolution);r=constrain(r,0,VECTOR_FIELD.cols-1),a=constrain(a,0,VECTOR_FIELD.rows-1);var o=grid[r][a];this.random.randomFn();.8,o*="circuit"==VECTOR_FIELD.choice?1:this.random.range(.8,1.1);var l=VECTOR_FIELD.minValue,n=VECTOR_FIELD.maxValue,h=int(map(o,l,n,0,COLOR_PALETTE.length-1));return h=constrain(h,0,COLOR_PALETTE.length-1),COLOR_PALETTE[h]}if("weighted"==this.technique.name){let t=floor(weightedRandom(COLOR_WEIGHT));for(var c=0;null==t||isNaN(t);){if(c>1e3){t=floor(this.random.random(COLOR_PALETTE.length-1));break}c++,t=floor(weightedRandom(COLOR_WEIGHT)),t=constrain(t,0,COLOR_PALETTE.length-1)}return t=constrain(t,0,COLOR_PALETTE.length-1),COLOR_PALETTE[t]}if("gradient"==this.technique.name){if("vertical"==this.variation){let t=map(e,0,height,0,COLOR_PALETTE.length-1);return t=floor(t),t=constrain(t,0,COLOR_PALETTE.length-1),COLOR_PALETTE[t]}if("horizontal"==this.variation){let e=map(t,0,width,0,COLOR_PALETTE.length-1);return e=floor(e),e=constrain(e,0,COLOR_PALETTE.length-1),COLOR_PALETTE[e]}if("radial"==this.variation){var d=sqrt(sq(width/2-t)+sq(height/2-e)),_=sqrt(sq(width/2-0)+sq(height/2-0));return new Gradient(COLOR_PALETTE,d,0,_).pickColor()}}if("stripes"==this.technique.name){let i=this.random.list(this.technique.variations);if("horizontal"==i){let e="",i=constrain(floor(t/columnWidth),0,totalColumns-1),s=floor(i%COLOR_PALETTE.length),r=new Value(0,COLOR_PALETTE.length-1,1);return r.value=s,r.sub(),e=COLOR_PALETTE[r.value],e}if("vertical"==i){let t="",i=constrain(floor(e/rowHeight),0,totalRows-1),s=floor(i%COLOR_PALETTE.length),r=new Value(0,COLOR_PALETTE.length-1,1);return r.value=s,r.sub(),t=COLOR_PALETTE[r.value],t}if("diagonal"==i)return"#efefef"}}}class Gradient{constructor(t,e,i,s){this.colors=t,this.d=e,this.min=i,this.max=s,this.fillColor="",this.n=this.colors.length}pickColor(){var t=0;return t=floor(map(this.d/this.max,0,1,this.n-1,0)),t=constrain(t,0,this.n-1),this.fillColor=this.colors[t],this.fillColor}}class Bead{constructor(t,e,i,s){this.random=new RandomClass,this.x=t,this.y=e,this.radius=0,this.canvasBgColor=BACKGROUND_COLOR,this.canvas=null,this.size_category="normal",this.fillColor="#eb4034",this.reflection_angle=REFLECTION_ANGLE,this.bead_type=i,"glossy"==BEAD_TYPE&&(this.bead_type="glossy"),"hollow"==BEAD_TYPE&&(this.bead_type="hollow"),"variable"==BEAD_TYPE&&(this.bead_type=this.random.list(["glossy","hollow"])),this.bead_size=s,this.enable_shadow=!0,this.rules()}rules(){"small"==this.bead_size&&(this.radius=7),"medium"==this.bead_size&&(this.radius=20),"large"==this.bead_size&&(this.radius=45)}draw(){if(null!=this.canvas?this.canvas.noStroke():noStroke(),noStroke(),"glossy"==this.bead_type){null!=this.canvas&&(this.canvas.fill(this.fillColor),this.canvas.circle(this.x,this.y,this.radius)),fill(this.fillColor),ellipse(this.x,this.y,this.radius,this.radius),this.canvas.push(),this.canvas.translate(this.x,this.y),this.canvas.rotate(this.reflection_angle);let t,e=.25,i=map(this.radius,45,7,45*e,10*e);"normal"==this.size_category&&(t=map(this.radius,45,7,13,map(scale_,2,5,-1,10))),"smallest"==this.size_category&&(t=map(this.radius,45,7,13,map(scale_,2,5,-.3,3)));let s="#ffffff";this.canvas.fill(s),this.canvas.strokeWeight(0),this.canvas.circle(0,0-t,i),this.canvas.pop()}if("hollow"==this.bead_type){null!=this.canvas&&(this.canvas.fill(this.fillColor),this.canvas.ellipse(this.x,this.y,this.radius,this.radius)),fill(this.fillColor),ellipse(this.x,this.y,this.radius,this.radius);let t=.3*this.radius,e=this.canvasBgColor;null!=this.canvas&&(this.canvas.fill(e),this.canvas.strokeWeight(0),this.canvas.ellipse(this.x,this.y,t,t)),fill(e),strokeWeight(0),ellipse(this.x,this.y,t,t)}}}class Stream{constructor(t){this.id=t,this.particles=[]}addToStream(t){this.particles.append(t)}getLength(){return this.particles.length}}class Particle{constructor(t,e,i,s){this.streamId=0,this.x=t,this.y=e,this.step_length=1,this.num_steps=600,this.step_count=0,this.stop_drawing=!1,this.prevx=0,this.prevy=0,this.size_category="normal",this.xstop=0,this.ystop=0,this.minh=252,this.maxh=this.minh+50,this.r=i,this.pickColor(),this.alternatingColor=!1,this.ogParticleColor="",this.particleColor="",this.random=new RandomClass,this.drawThis=!0}pickColor(){return COLORING_TECHNIQUE.apply(this.x,this.y)}mapPosition(t){strokeWeight(.5*scale_),stroke("aqua"),line(t.x,t.y,t.x,0),line(t.x,t.y,t.x,height),stroke("green"),line(t.x,t.y,0,t.y),line(t.x,t.y,width,t.y),strokeWeight(1*scale_),stroke("#ff00fb"),line(t.x,t.y,t.x+this.r+300,0),strokeWeight(4*scale_),point(t.x,t.y),console.log(get(t.x+this.r,t.y))}update(t){var e=this.x-VECTOR_FIELD.left_x,i=this.y-VECTOR_FIELD.top_y,s=floor(e/VECTOR_FIELD.resolution),r=floor(i/VECTOR_FIELD.resolution);s=constrain(s,0,VECTOR_FIELD.cols-1),r=constrain(r,0,VECTOR_FIELD.rows-1);var a=0,o=0,l=.7835,n=1.134912;if(this.prevx=this.x,this.prevy=this.y,this.x>frameWidth&&this.x<_width-frameWidth&&this.y<_height-frameWidth&&this.y>frameWidth){var h=grid[s][r];if(center_of_rotation&&"target"!=VECTOR_FIELD.choice)a=this.step_length*cos(h-HALF_PI*l)*this.r*n,o=this.step_length*sin(h-HALF_PI*l)*this.r*n;else a=this.step_length*cos(h)*this.r*1.05,o=this.step_length*sin(h)*this.r*1.05;map(this.r/scale_,.09,.8,.8,.95);this.xstop=a/1*1.8,this.ystop=o/1*1.8;var c,d=this.x+a,_=this.y+o;new Particle(this.x,this.y,this.r);(c=collidesWithAnyCircle({x:d,y:_,r:this.r},t))&&this.end(),this.x+=a,this.y+=o;var u=!1,g=get(this.x,this.y);if(g[0]==red(BACKGROUND_COLOR)&&g[1]==green(BACKGROUND_COLOR)&&g[2]==blue(BACKGROUND_COLOR)&&(u=!0),!c&&u){this.alternatingColor?this.particleColor=this.pickColor():this.particleColor=this.ogParticleColor,circle_={x:this.x,y:this.y,r:this.r,particleColor:this.particleColor,prevx:this.prevx,prevy:this.prevy,xstop:this.xstop,ystop:this.ystop,size_category:this.size_category},t.addToCell(circle_);var m=this.getStream(this.streamId),p=circle_;m.particles.push(p),BEAD_COUNT++,this.draw(),this.update(t)}else this.end()}else this.end()}end(){this.step_count=this.num_steps+1,this.stop_drawing=!0}getStream(t){for(var e,i=0;i<streams.length;++i)if(streams[i].id==t){e=streams[i];break}return e}draw(){if(0==this.stop_drawing){var t="glossy";this.random.randomFn();var e=map(this.r/scale_,.09,.8,.1,.25);1==STRINGS&&0!=this.prevx&&0!=this.prevy&&(line(this.prevx,this.prevy,this.prevx-this.xstop,this.prevy-this.ystop),stroke(STRING_COLOR),strokeWeight(e),line(this.prevx,this.prevy,this.prevx+this.xstop,this.prevy+this.ystop),strokeWeight(0)),"variable"==STRINGS&&0!=this.prevx&&0!=this.prevy&&(line(this.prevx,this.prevy,this.prevx-this.xstop,this.prevy-this.ystop),this.random.randomFn()<.3&&(stroke(STRING_COLOR),strokeWeight(e),line(this.prevx,this.prevy,this.prevx+this.xstop,this.prevy+this.ystop),strokeWeight(0)));var i=new Bead(this.x,this.y,t,"small");i.size_category=this.size_category,i.canvas=BEAD_CANVAS,i.radius=this.r,i.fillColor=this.particleColor,BEAD_CANVAS.strokeWeight(0),i.draw()}}display(){var t="glossy";var e=map(this.r/scale_,.09,.8,.1,.25);1==STRINGS&&0!=this.prevx&&0!=this.prevy&&(line(this.prevx,this.prevy,this.prevx-this.xstop,this.prevy-this.ystop),stroke(STRING_COLOR),strokeWeight(e),line(this.prevx,this.prevy,this.prevx+this.xstop,this.prevy+this.ystop),strokeWeight(0)),"variable"==STRINGS&&0!=this.prevx&&0!=this.prevy&&(line(this.prevx,this.prevy,this.prevx-this.xstop,this.prevy-this.ystop),this.random.randomFn()<.3&&(stroke(STRING_COLOR),strokeWeight(e),line(this.prevx,this.prevy,this.prevx+this.xstop,this.prevy+this.ystop),strokeWeight(0)));var i=new Bead(this.x,this.y,t,"small");i.size_category=this.size_category,i.canvas=BEAD_CANVAS,i.radius=this.r,i.fillColor=this.particleColor,BEAD_CANVAS.strokeWeight(0),i.draw()}}class SpatialGrid{constructor(t){this.cellSize=t,this.grid=[]}initializeGrid(t,e){for(let i=0;i<t;i++){this.grid[i]=[];for(let t=0;t<e;t++)this.grid[i][t]=[]}}getIndex(t,e){return{col:floor(t/this.cellSize),row:floor(e/this.cellSize)}}addToCell(t){const{col:e,row:i}=this.getIndex(t.x,t.y);this.grid[e][i].push(t)}removeFromCell(t){const{col:e,row:i}=this.getIndex(t.x,t.y);t.r=t.r/2;let s=this.grid[e][i].indexOf(t);if(-1!==s){var r=this.grid[e][i];r[s]=r[r.length-1],r.pop()}}removeFromCell_(t){const{col:e,row:i}=this.getIndex(t.x,t.y),s=this.grid[e][i];let r=!1;for(let e=0;e<s.length;e++)if(s[e].x===t.x&&s[e].y===t.y){s.slice(e,1),r=!0;break}}updateCell(t,e,i){this.removeFromCell(t),this.addToCell(t)}getTotalParticles(){let t=0;for(let e=0;e<this.grid.length;e++)for(let i=0;i<this.grid[e].length;i++)t+=this.grid[e][i].length;return t}}class FlowField{constructor(){this.random=new RandomClass,this.resolution=10*scale_,RESOLUTION=this.resolution,this.left_x=int(-.1*width),this.right_x=int(1.1*width),this.top_y=int(-.1*height),this.bottom_y=int(1.1*height),this.cols=int((this.right_x-this.left_x)/this.resolution),this.rows=int((this.bottom_y-this.top_y)/this.resolution),this.grid=[],this.distortPath=this.random.range(.1,.3),this.fields=["smooth","geometric","target","infinite"],this.choice="",this.values=[],this.minValue=0,this.maxValue=0,this.centerProb=.2,this.centerLimit=.3,this.centers_of_rotation=CENTERS_OF_ROTATION,this.centers=[],this.getCenters(this.centers_of_rotation),this.visual=!1,this.pick()}getCenters(t){if(1==t)this.centers.push({x1:width/2+2*frameWidth,y1:height/2+2*frameWidth});else for(var e=0;e<t;++e)this.centers.push({x1:this.random.range(.2*width,.8*width)+2*frameWidth,y1:this.random.range(.2*height,.8*height)+2*frameWidth})}pick(){let t=int(weightedRandom({0:.5,1:.3,2:.2,3:.1}));"smooth"==FLOWFIELD_TYPE&&(t=0),"geometric"==FLOWFIELD_TYPE&&(t=1),"target"==FLOWFIELD_TYPE&&(t=2),"infinite"==FLOWFIELD_TYPE&&(t=3),this.choice=this.fields[t],this.generate()}pickSpecificField(t){var e=t-1;this.choice=this.fields[e],this.generate()}generate(){if("smooth"==this.choice){let e=round(this.random.range(100,1e3),4);e=200;let i=0,s=0,r=0;r=round(this.random.range(.08,.2),4);var t=parseFloat(weightedRandom({.3:.35,.2:.6,.45:.05}));console.log("nDetailMaxValue: "+t);let a=.069,o=this.random.random(2e3),l=10,n=round(this.random.range(.1,t),4);noiseSeed(o),noiseDetail(l,n);this.random.range(0,2);for(let t=0;t<this.cols;t++){i=e,grid[t]=[],grid_data[t]=[];for(let e=0;e<this.rows;e++){let o=noise(i*a,s*a)*TWO_PI*4;grid[t][e]=o,grid_data[t][e]={angle:o,circles:[]},this.values.push(o),i+=r}s+=r}}if("infinite"==this.choice){let t=0,r=0,a=0,o=this.random.random(1e3),l=10,n=round(this.random.range(.05,.3),4);n=.5,noiseSeed(o),noiseDetail(l,n);var e=0;for(let o=0;o<this.cols;o++){t=0,grid[o]=[],grid_data[o]=[];for(let r=0;r<this.rows;r++){if(this.centerProb<this.centerLimit){var i=this.resolution;for(var s of this.centers)e+=atan2(int(s.y1/i)-r,int(s.x1/i)-o)}grid[o][r]=e,grid_data[o][r]={angle:e,circles:[]},this.values.push(e),t+=a,e=0}r+=a}}if("target"==this.choice){this.centerx=width/2+2*frameWidth,this.centery=height/2+2*frameWidth;let t=0,e=0,i=.03,s=.1005,r=this.random.random(1e3),a=this.random.random(1e3),o=round(this.random.range(.05,.3),4);noiseSeed(r),noiseDetail(a,o);for(let r=0;r<this.cols;r++){t=0,grid[r]=[],grid_data[r]=[];for(let a=0;a<this.rows;a++){noise(t*s,e*s);let o=atan2(int(this.centery/this.resolution)-a,int(this.centerx/this.resolution)-r);grid[r][a]=o,grid_data[r][a]={angle:o,circles:[]},this.values.push(o),t+=i}e+=i}}if("geometric"==this.choice){let t=0,e=0,i=round(this.random.range(.03,.069),4);i=round(this.random.range(.1,.2),4),i=.15;let s=Math.round(this.random.range(1.8,2),4),r=this.random.random(100),a=Math.round(this.random.range(3,4),4),o=this.random.range(.65,.78);noiseDetail(a,o),noiseSeed(r);for(let r=0;r<this.cols;r++){t=0,grid[r]=[],grid_data[r]=[];for(let a=0;a<this.rows;a++){let o=Math.round(noise(.05*t,.05*e)*TWO_PI*s,0);grid[r][a]=o,grid_data[r][a]={angle:o,circles:[]},this.values.push(o),t+=i}e+=i}}this.minValue=getMin(this.values),this.maxValue=getMax(this.values)}visualize(t){if(this.visual)for(let a=0;a<this.cols;a++)for(var e=0;e<this.rows;e++){var i=grid[a][e],s=p5.Vector.fromAngle(i);t.stroke("#ffffff"),t.strokeWeight(2),t.push();var r=this.resolution;t.stroke("#ffffff"),t.translate(e*r,a*r),t.stroke("#4e788a"),t.fill("#00000000"),t.rect(0,0,r,r),t.rotate(s.heading()),t.line(0,0,this.resolution,0),t.pop()}}analyze_values(){FLOWFIELD=this.values;let t=getMin(this.values),e=getMax(this.values);for(var i=0;i<this.values.length;++i){var s=this.values[i];this.values[i]=map(s,t,e,0,1)}MIN_VALUE=t,MAX_VALUE=e,FLOWFIELD=this.values}}function draw_grid_element(t,e,i){var s=RESOLUTION;t.fill("#f00"),t.rect(i*s,e*s,s,s)}class Phyllotaxis{constructor(t,e,i){this.angle=0,this.n=0,this.c=40,this.a=0,this.r=0,this.shift={x:e/2,y:i/2},this.angle_variations={less:137.3,norm:137.5,more:137.6},this.random=new RandomClass,"less"==SPIRAL_TYPE&&(this.angle=this.angle_variations.less),"normal"==SPIRAL_TYPE&&(this.angle=this.angle_variations.norm),"more"==SPIRAL_TYPE&&(this.angle=this.angle_variations.more),this.counter=0,this.bead_size="small","small"==bead_size&&(this.bead_size="small"),"large"==bead_size&&(this.bead_size="large"),"medium"==bead_size&&(this.bead_size="medium")}update(){this.counter++;let t=this.random.list(["hollow","glossy"]),e=this.bead_size;this.a=int(this.n*this.angle),"large"==e?(this.r=3.5*int(this.c*sqrt(this.n)),this.r*=2):"medium"==e?this.r=4.5*int(this.c*sqrt(this.n)):"small"==e&&(this.r=1*int(this.c*sqrt(this.n)),this.r*=map(scale_,2,5,2,6));let i=this.r*cos(this.a)+width/2,s=this.r*sin(this.a)+height/2,r=new Bead(i,s,t,e);r.radius*=map(scale_,1,5,1,7.5),r.canvas=BEAD_CANVAS;var a={x:r.x,y:r.y,r:r.radius},o=collidesWithAnyCircle(a,spatialGrid),l=!1,n=get(i,s);if(n[0]==red(BACKGROUND_COLOR)&&n[1]==green(BACKGROUND_COLOR)&&n[2]==blue(BACKGROUND_COLOR)&&(l=!0),i>frameWidth&&i<_width-frameWidth&&s<_height-frameWidth&&s>frameWidth&&!o&&l){var h=COLORING_TECHNIQUE.apply(this.x,this.y);r.fillColor=h,a.fillColor=h,BEAD_COUNT++,r.draw(),spatialGrid.addToCell(a)}this.n++}}class Value{constructor(t,e,i){this.start=t,this.end=e,this.inc=i,this.value=0}add(){this.value<this.end?this.value+=this.inc:this.value=this.start}sub(){this.value>0?this.value-=this.inc:this.value=this.end}print(){console.log(this.value)}}var COLOR_SCHEMES,COLOR_WEIGHT,COLOR_PALETTE,COLORING_TECHNIQUE,GRADIENT_FLIP,BACKGROUND_COLOR,_random=new RandomClass,aspect_ratio={w:9,h:17},_width=800*scale_,_height=_width*aspect_ratio.h/aspect_ratio.w,DEFAULT_PALETTE="Palette #1",vertical_colors=[],rowHeight=.05*_height,totalRows=_random.floorFn(_height/rowHeight),horizontal_colors=[],columnWidth=.05*_width,totalColumns=_random.floorFn(_height/columnWidth),frameWidth=.04*_width,default_framerate=60,rx=frameWidth+_random.range(0,1)*(_width-2*frameWidth),ry=frameWidth+_random.range(0,1)*(_height-2*frameWidth),rr=300*_random.randomFn();rx=_width/2,ry=_height/2;var FLOWFIELD,FLOWFIELD_TYPE,RESOLUTION,MIN_VALUE,MAX_VALUE,VECTOR_FIELD,bead,phyllo,grid=[],grid_data=[],circles=[],particles=[],FLOWFIELD_GENERATION=!1,global_radius=.2+.12*_random.range(0,1),bead_type="hollow",bead_size="large",REFLECTION_ANGLE=Math.PI*_random.list([-1,1])*_random.range(.1,1),CONSTANT_SIZE=!0,CONSTANT_SIZE_P=!0,CONSTANT_SIZE_NEAT=.23;CONSTANT_SIZE_NEAT=.2;var ALTERNATING_CHANCE,buffer,pattern,BEAD_COUNT=0,EXTRA_FILL=!1,VARY_CHANCE=_random.range(0,1),smallest_size=.11,normal_size=.16,size_probability={0:.2,1:.8},selectSize=parseInt(weightedRandom(size_probability),10),NORMAL_BEAD_SIZE=0===selectSize?smallest_size:normal_size,LARGEST_BEAD_SIZE=.4,min_alt=.5,max_alt=.8,STREAM_COUNT=0,streams=[],STRINGS=!0,STRING_COLOR="#faf3e6BA",ALLOW_PATTERN=!1,patternProb=.5,patternRandChance=_random.range(0,1);patternRandChance<patternProb&&(ALLOW_PATTERN=!0);var cnv,testcnv,field,srand=new RandomClass,phyllo_curves_drawn=!1,SPIRAL_TYPE="less",center_of_rotation=!1,rec_curves_drawn=!1,CENTERS_OF_ROTATION=1,visualize_centers=!1,traits=new Probability,chosenPaletteGUI=[],chosenBgPaletteGUI=[],done_generating=!1,num_of_outputs=2;const cellSize=20,spatialGrid=new SpatialGrid(20),cols=Math.ceil(_width/20),rows=Math.ceil(_height/20);spatialGrid.initializeGrid(cols,rows);var revealInterval,RENDER_TIME=0,guiding_points=[],CONT_COUNT=0,click_count=0,max_clicks=20,click_values=[],global_score=0,REVEAL_FASTER=!1,randomQuotes=[{text:"In mordern war... you will die like a dog for no good reason. ",author:"Ernest Hemingway"},{text:"It is fine to celebrate success, but it is more important to heed the lessons of failure.",author:"Bill Gates"},{text:"Don't get mad, get even.",author:"Robert F. Kennedy"},{text:"Do not be embarrassed by your failures, learn from them and start again.",author:"Richard Branson"},{text:"Most of my conscious efforts have ended in embarrassing failure...",author:"Ingmar Bergman"},{text:"You have not failed, you have succeeded in not winning.",author:"Unknown"}],odd_color_check=!1;function checkOddColor(t){if(0==odd_color_check)for(var e=0;e<COLOR_PALETTE.length;++e){var i=red(t),s=green(t),r=blue(t),a=red(COLOR_PALETTE[e]),o=green(COLOR_PALETTE[e]),l=blue(COLOR_PALETTE[e]);if(i!=a&&s!=o&&r!=l){console.log("ODD COLOR DETECTED"),odd_color_check=!0;break}}}let load_bead_sound,good_score_sound,bad_score_sound;function preload(){load_bead_sound=loadSound("beads.wav"),good_score_sound=loadSound("good-score.wav"),bad_score_sound=loadSound("bad-score.wav")}function setup(){createCanvas(_width,_height),pixelDensity(1),buffer=createGraphics(_width,_height),cnv=createGraphics(_width,_height),BEAD_CANVAS=createGraphics(_width,_height),testcnv=createGraphics(_width,_height),setSeed(seedNumber),console.log("generated seed: "+seed),ALTERNATING_CHANCE=_random.range(min_alt,max_alt),selectSize=parseInt(weightedRandom(size_probability),10),NORMAL_BEAD_SIZE=0===selectSize?smallest_size:normal_size,attributes=[],circles=[],particles=[],BEAD_COUNT=0,STREAM_COUNT=0,streams=[],spatialGrid.initializeGrid(cols,rows),RENDER_TIME=0,generate()}function generate(){clear(),odd_color_check=!1,REFLECTION_ANGLE=Math.PI*_random.list([-1,1])*_random.range(.1,1),global_radius=.2+.12*_random.range(0,1);var t=traits.calculateStructureProbability(),e=traits.calculateBeadSizeProbability(),i=traits.calculateSpiralTypeProbability(),s=traits.calculateStringsProbability(),r=traits.calculateFlowfieldTypeProbability(),a=traits.calculateRotationCentersProbability(),o=traits.calculatePaletteProbability();0==t&&(layout_flowfield=!0,layout_phyllotaxis=!1),1==t&&(layout_flowfield=!1,layout_phyllotaxis=!0),layout_flowfield=!0,layout_phyllotaxis=!1,BEAD_TYPE="glossy",bead_size="small",COL_TECHNIQUE="weighted",layout_phyllotaxis&&(SPIRAL_TYPE=0==i?"normal":"less"),layout_flowfield&&(0==r&&(FLOWFIELD_TYPE="smooth"),1==r&&(FLOWFIELD_TYPE="geometric"),2==r&&(FLOWFIELD_TYPE="infinite")),layout_flowfield&&r&&(1==a&&(CENTERS_OF_ROTATION=1),2==a&&(CENTERS_OF_ROTATION=2),3==a&&(CENTERS_OF_ROTATION=3),4==a&&(CENTERS_OF_ROTATION=4)),0==e&&(CONSTANT_SIZE=!0),1==e&&(CONSTANT_SIZE=!1),layout_phyllotaxis&&(CONSTANT_SIZE=!0),0==s&&(STRINGS=!0),1==s&&(STRINGS=!1),layout_phyllotaxis&&(STRINGS=!1),BACKGROUND_COLOR=_random.list(o.backgrounds),COLOR_PALETTE=o.palette.shuffle(seedNumber),STRING_COLOR=_random.list(o.stringColor),COLOR_PALETTE=o.palette,attributes.push({trait_type:"Palette",value:o.name}),1!=layout_flowfield||0!=r&&2!=r||attributes.push({trait_type:"Pattern",value:"Fluid"}),1==layout_flowfield&&1==r&&attributes.push({trait_type:"Pattern",value:"Linear"}),1==layout_phyllotaxis&&0==layout_flowfield&&attributes.push({trait_type:"Pattern",value:"Sunflower"}),1==STRINGS&&attributes.push({trait_type:"Strings",value:"Visible"}),0==STRINGS&&attributes.push({trait_type:"Strings",value:"Invisible"}),1==CONSTANT_SIZE&&attributes.push({trait_type:"Bead Sizes",value:"Balanced"}),0==CONSTANT_SIZE&&attributes.push({trait_type:"Bead Sizes",value:"Mixed"}),background(BACKGROUND_COLOR),bead_type="hollow",bead_size="small",COLORING_TECHNIQUE=new ColoringTechnique,COLOR_WEIGHT=generateWeights(COLOR_PALETTE.length),layout_flowfield&&(field=new FlowField,RESOLUTION=10,VECTOR_FIELD=field,center_of_rotation=!0),layout_phyllotaxis&&((phyllo=new Phyllotaxis(2,_width,_height)).c=5)}var attributes=[],first_bead_created=!1;function draw(){if(layout_phyllotaxis){const i=new Date;var t=5e3;"small"==phyllo.bead_size&&(t=map(scale_,2,5,3e4,114e3));for(var e=0;e<t;++e)phyllo.update();image(BEAD_CANVAS,0,0),noLoop(),done_generating=!0,console.log("Bead Count: "+BEAD_COUNT);const s=new Date;RENDER_TIME+=(s-i)/1e3,console.log("Render time: "+round(RENDER_TIME,2)+" seconds")}if(layout_flowfield){const t=new Date;$("#revealBtn").on("click",(function(){REVEAL_FASTER=!1,revealFullResult()})),$("#revealBtnTwo").on("click",(function(){REVEAL_FASTER=!0,clearInterval(revealInterval),revealFullResult()})),$(".closeBtn").on("click",(function(){$(this).parent().hide()})),$(".newGame").on("click",(function(){window.location=""})),$("#saveProgress").on("click",(function(){var t;t=click_count<max_clicks?"heritage_game_score_"+global_score+"_incomplete":"heritage_game_score_"+global_score+"_complete",saveCanvas(t,"png")})),console.log("Bead Count: "+BEAD_COUNT);const e=new Date;RENDER_TIME+=(e-t)/1e3,weedOut(1,2,3),console.log("Render time: "+round(RENDER_TIME,2)+" seconds"),noLoop(),done_generating=!0}done_generating&&console.log("CODE_CANVAS_ATTRIBUTES_READY=",JSON.stringify(attributes))}function generatePoint(){return{x:random(frameWidth,_width-frameWidth),y:random(frameWidth,_height-frameWidth),r:150,color:"#43a3eaa6",active:!0}}function getModeRangeAverage(t){let e={};t.forEach((t=>{if(t>=10&&t<100){let i=10*Math.floor(t/10);e[i]||(e[i]=[]),e[i].push(t)}}));let i=null,s=0;for(let t in e)e[t].length>s&&(s=e[t].length,i=t);if(null!==i){let t=e[i];return t.reduce(((t,e)=>t+e),0)/t.length}return null}function getAverage(t){return t.reduce(((t,e)=>t+e),0)/t.length||0}function revealFullResult(){var t=2e4;if(t*=1.4,REVEAL_FASTER){clearInterval(undefined);for(var e=0;e<t;++e)size_factor=e<7e3?1:e>7e3&&e<14e3?.5:e>14e3&&e<21e3?.75:.25,draw_curves(size_factor)}else{e=0;var i=0;revealInterval=setInterval((()=>{e<t&&(size_factor=e<7e3?1:e>7e3&&e<14e3?.5:e>14e3&&e<21e3?.75:.25,draw_curves(size_factor),i=streams[streams.length-1].particles.length,document.querySelector("#scoreValue").innerHTML=1==i?i+" bead":i+" beads")}),5)}weedOut(1,2,3)}function evaluateQuickScore(t){t<40&&t>0&&($("#scoreValue").css("color","#f90c0c"),$(".meter").css("border-color","#f90c0c"),$(".meter span").css("background","#f90c0c")),t<60&&t>40&&($("#scoreValue").css("color","#e78909"),$(".meter").css("border-color","#e78909"),$(".meter span").css("background","#e78909")),t<100&&t>60&&($("#scoreValue").css("color","#1ee029"),$(".meter").css("border-color","#1ee029"),$(".meter span").css("background","#1ee029")),$(".meter > span").each((function(){$(this).data("origWidth",$(this).width()).width(t).animate({width:$(this).data("origWidth")},1200)}))}function mousePressed(){if(mouseX>=0&&mouseX<=width&&mouseY>=0&&mouseY<=height)if(click_count<max_clicks){load_bead_sound.play(),click_count++,$("#attemptsValue").text(click_count<max_clicks?click_count:max_clicks);var t=random([1,.5,.75,.25]);draw_curves_manually(mouseX,mouseY,t);let s,r=streams.length>0?streams[streams.length-1].particles.length:0;var e;if(s=r<=50?int(map(r,0,50,0,80)):int(map(r,50,160,80,100)),s=constrain(s,0,100),global_score=s,click_values.length<max_clicks-1)click_values.push(s),$("#scoreValue").html(s+"%"),evaluateQuickScore(s);else if(e=int(getAverage(click_values)),$("#scoreValue").html("Final Score: "+e+"%"),global_score=e,e>70)good_score_sound.play(),$("#scoreValue").css("color","#1ee029"),$(".meter").css("border-color","#1ee029"),$(".meter span").css("background","#1ee029"),$("#gameModalTwo").show(),$(".reveal-container").css("display","flex"),$("#revealTwoBtn").addClass(".rotated3d .active");else{bad_score_sound.play(),$("#scoreValue").css("color","#f90c0c"),$(".meter").css("border-color","#f90c0c"),$(".meter span").css("background","#f90c0c");var i=random(randomQuotes);$("#randomQuotes").text('"'+i.text+'" - '+i.author),$("#gameModalOne").show()}}else $("#gameModal").show()}function saveOutput(){saveCanvas("Heritage","png")}function weedOut(t,e,i){var s;s=streams,_random.randomFn()<1&&(s=streams.filter((t=>t.particles.length>1)));var r=new Date;for(stream of(clear(),BEAD_CANVAS.clear(),background(BACKGROUND_COLOR),s))for(particle of stream.particles){var a=new Particle(particle.x,particle.y,particle.r);a.size_category=particle.size_category,a.particleColor=particle.particleColor,a.prevx=particle.prevx,a.prevy=particle.prevy,a.xstop=particle.xstop,a.ystop=particle.ystop,a.display()}image(BEAD_CANVAS,0,0);var o=new Date;RENDER_TIME+=(o-r)/1e3}function draw_curves(t){var e=1,i=width-4*frameWidth,s=height-4*frameWidth,r=randomGaussian(1*i*.5,1*i*.5),a=randomGaussian(1*s*.5,1*s*.5);if(1==CONSTANT_SIZE)if(EXTRA_FILL){null!=t&&(e=map(t,1,0,.2,.009))}else e=NORMAL_BEAD_SIZE;else e=0===parseInt(weightedRandom({0:.5,1:.5}),10)?smallest_size:normal_size;p_radius=55*e*scale_;var o=collidesWithAnyCircle({x:r,y:a,r:p_radius},spatialGrid),l=!1;if(r>frameWidth&&r<_width-frameWidth&&a<_height-frameWidth&&a>frameWidth&&(l=!0),!o&&l){var n;circle_={x:r,y:a,r:p_radius,particleColor:"",prevx:0,prevy:0,xstop:0,ystop:0,size_category:""},spatialGrid.addToCell(circle_);var h=!1,c=get(r,a);if(c[0]==red(BACKGROUND_COLOR)&&c[1]==green(BACKGROUND_COLOR)&&c[2]==blue(BACKGROUND_COLOR)&&(h=!0),l&&h){var d=new Stream(STREAM_COUNT);STREAM_COUNT++,(n=new Particle(r,a,p_radius)).streamId=d.id,e==smallest_size&&(n.size_category="smallest",circle_.size_category="smallest"),e==normal_size&&(n.size_category="normal",circle_.size_category="normal");var _=COLORING_TECHNIQUE.apply(r,a);n.ogParticleColor=_,_random.randomFn()<ALTERNATING_CHANCE&&(n.alternatingColor=!0),circle_.particleColor=_,particles.push(n),streams.push(d);this.getStream(this.streamId);var u=circle_;d.particles.push(u),n.draw(),n.update(spatialGrid)}}}function draw_curves_manually(t,e,i){var s=1;width,height;if(1==CONSTANT_SIZE)if(EXTRA_FILL){null!=i&&(s=map(i,1,0,.2,.009))}else s=NORMAL_BEAD_SIZE;else s=0===parseInt(weightedRandom({0:.5,1:.5}),10)?smallest_size:normal_size;p_radius=55*s*scale_;var r=collidesWithAnyCircle({x:t,y:e,r:p_radius},spatialGrid),a=!1;if(t>frameWidth&&t<_width-frameWidth&&e<_height-frameWidth&&e>frameWidth&&(a=!0),!r&&a){var o;circle_={x:t,y:e,r:p_radius,particleColor:"",prevx:0,prevy:0,xstop:0,ystop:0,size_category:""},spatialGrid.addToCell(circle_);var l=!1,n=get(t,e);if(n[0]==red(BACKGROUND_COLOR)&&n[1]==green(BACKGROUND_COLOR)&&n[2]==blue(BACKGROUND_COLOR)&&(l=!0),a&&l){var h=new Stream(STREAM_COUNT);STREAM_COUNT++,(o=new Particle(t,e,p_radius)).streamId=h.id,s==smallest_size&&(o.size_category="smallest",circle_.size_category="smallest"),s==normal_size&&(o.size_category="normal",circle_.size_category="normal");var c=COLORING_TECHNIQUE.apply(t,e);o.ogParticleColor=c,_random.randomFn()<ALTERNATING_CHANCE&&(o.alternatingColor=!0),circle_.particleColor=c,particles.push(o),streams.push(h);this.getStream(this.streamId);var d=circle_;h.particles.push(d),o.draw(),o.update(spatialGrid)}}}function getStream(t){for(var e,i=0;i<streams.length;++i)if(streams[i].id==t){e=streams[i];break}return e}